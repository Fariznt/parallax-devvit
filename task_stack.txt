
try without redditapi enabled
test removal/modmail integration
(keep ban-related code in my gitignore for now (move it) + ask about it in request if possible)

reddit dev testing

add some  function header comments

publish ASAP
UI/web migration is a priority


Future
0. catch errors in main.ts, log, and dont take action
1. support for posts, not just comments (image understanding? at least route title as a comment)
2. switch to yaml -> json conversion
3. check compatibility with other apis
4. consider migration to web-style when functional (high priority due to resume significance)
    allows UI for policy definition + UI action into reddit's interface for mods (ex. get trace) + webdev credibility
    + trace visibility
5. wrapping this is fundamental https://platform.openai.com/docs/guides/moderation?utm_source=chatgpt.com
    (MUST CHANGE TOS ACCORINDGLY)
6. incorporate use of post history
7. validate only one check per level (rn takes the cheapest one)
8. hella documentation
    more than one semantic node in any_of block is invalid. enforce through validation
    input threads need identifiers
    any of leaves downstream violations which may be interdependent
    -semantic node has not been stress tested for a reasonable limit on semantic nodes per policy
    (how much can one prompt handle) and it would be difficult/unreasonable to do so (theres always a stronger model,
    and the splitting depends on use case/semantic complexity) (a framework to help users do this would be nice in the future)
9. make address exist with line breaks
10. change whitelist blacklist to allow and deny
11. abstract away violation and nodeid init
12. add to validation that semantic_check is invalid if no deafult LLMConfig or referenced key is missing etc.
13. get rid of indexing in addresses... its unnecessary
14. make types location consistent (theres some in validation rn)
15 enforce this in validation:
  if (newDefChecks > 1) {
    throw new Error(
      `1> computation-deferring nodes are not permitted downstream an 'any_of' node
       or downstream a 'not' node followed by an 'all_of' node.
      A policy refactor is necessarily possible and cheaper by combining combinator logic 
      into a semantic_node.`
    )
  }
16. consider capping deferred checks such that past a threshold its split
and/or more evaluation modes like cross-content batching, 0 batching
17. support for how hard to think and maybe some sort of modding history testing pipeline
18. llm throttling
19. use menuitem as on/off button
20. custom number of days banned

gassing up the project for resume. things i dont want to forget:
-Tested for context awareness (thread history)
-Tested for resistance against prompt injection
-Can represent any boolean expression over modular predicates

notes for me:
devvit settings set apiKey for setting apiKey
everything else set in mod tools
severity will be the closest upstream severity defined


figure out what im going to do in terms of tree representation. if decide against batch processing need to indicate in my architecture files
    these architectural decisions depend on the role this plays in the larger system
    perhaps: deterministic obvious removes (silent). removes + modmail. and non removes.
        i could keep the policyengine agnostic to this 3 way triage and do only 2 way. examine the trace, and llm involvement
        leads to modmail.
        So for r/izlam:
        final:
        all comments -> run through evaluation tree -> removed or not removed. if removed -> escalate to modmail with trace info
        report -> run through llm node -> remove or not removed. make removal sensitive/safe; if removed escalate to modmail else silent delete
        proto:
        all modqueue items -> run through llm -> trivial removed


        how can i deploy an automoderator 2nd phase version without writing much extra code that would be directly used in the final version?
            final version needs to be able to interact with modmail anyweayws and actually simply modmail event read + archive probably not too complicated, if feasible.
            i should rush early approval. then slowly work on building a proper engine that can be used elsewhere

reusable code:

For allowing custom number of days:
    //   // if not a known/configured action (ACTIONS or ban:<number>)
    //   if (!ACTIONS.has(action) && !(/^ban:\d+$/.test(action))) {
    //     throw new Error(
    //       `Invalid action "${action}" for severity "${rawKey}". ` +
    //       `Allowed actions: ${Array.from(ACTIONS).join(', ')}, ban:<number of days>`
    //     );
    //   }
for removal
  // if (result.violation) {
  //   if (result.violation)
  //   await context.reddit.remove(contentId, false);
  //   await context.reddit.addRemovalNote({
  //     itemIds: [contentId], 
  //     reasonId: "", // empty for now---may extract from trace in future
  //     modNote: result.modNote
  //   });
  //   // alert modmail as needed
  // }

  religious test
  /**
 * Runs a complex/nuanced example of a semantic node with
 * culturally sensitive condition (best use case of semantic node)
 * that a community may have chosen to govern content by. This example
 * tests knowledge-based evaluation---the LLM must know what constitutes
 * this belief system, not just read meaning.
 * 
 * Promotes normalizes, or trivializes beliefs or actions that contradict
 * doctrines of the Catholic Church as articulated in the Catechism,
 * Sacred Scripture, and Sacred Tradition
 * 
 * Wrapped in not node to violate for content meeting the above condition.
 * 
 * Returns true upon violation.
 */
async function semantic_religious(text: string): Promise<boolean> {
  return policyViolates(policies.semantic_simple, text)
}
